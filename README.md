[Demo](https://youtu.be/DSipIDj-5q0)


## Setup
Python 3.x environment
```
git clone https://github.com/aurelianocyp/diffused-heads
conda create -n diffused_heads python=3.8
conda activate diffused_heads
cd diffused-heads
pip install -r requirements.txt
conda install ffmpeg
```

## Sampling
Due to LRW license agreement, we are only able to provide a checkpoint of our model trained on CREMA.

The entire test set generated by our method can be downloaded from [here](https://drive.google.com/file/d/1zWSqtV7O4WGkgh6WB55b8Mdg2lXXUudH/view?usp=drive_link).


1. Download and unpack [checkpoints](https://drive.google.com/file/d/1U90egQvzERHclTYPCjZadrEMyF7TAPa-/view?usp=drive_link) (our model and pretrained audio encoder).
   
2. Download and unpack preprocessed CREMA [video](https://drive.google.com/file/d/1rM0FZLGiy-bJcxpv4CTlbUf0FuROubdk/view?usp=drive_link) and [audio](https://drive.google.com/file/d/1uS7Vi8EwarJFGQhsYHDMSkQmaNuiJIVW/view?usp=drive_link) files.
   
3. Specify paths and options in `config_crema.yaml` (check comments in the file).创建名为path的文件夹与名为to的文件夹，将两个checkpoint放进去
   
4. Run the script
```
python sample.py hydra.job.chdir=False
```
报错1：RuntimeError: indices should be either on cpu or on the same device as the indexed tensor (cpu)
在相应行之前添加上self.beta = self.beta.to(xt.device) 或者 self.log_beta_tilde_clipped = self.log_beta_tilde_clipped.to(xt.device)即可，注意需要更换相应self后的变量

## Using your own data
### Audio
You can use audio recordings of your choosing freely. The only requirements are 16 kHz audio rate and a single audio channel. Please note our model is able to generate videos up to 9 seconds long depending on the audio.

### Identity frame
It is highly recommended to use a frame from the provided CREMA videos. This instance of the model was trained on clips with green background only. If you want to use your identity frame anyway, please follow this [repo](https://github.com/DinoMan/face-processor) for face alignment. Additionally, you may want to try segmenting the person and replacing background to green.

## Training
A training script will be uploaded in the future (ETA December 2023).


